worker_processes auto;
events { worker_connections 1024; }
http {
  server {
    listen 8443 ssl;
    server_name localhost;

    # Self-signed dev certs (mount your own if desired)
  # Dev self-signed certificate (generate with scripts/gen_dev_tls.ps1)
  ssl_certificate     /etc/nginx/certs/dev-cert.pem;
  ssl_certificate_key /etc/nginx/certs/dev-key.pem;

    # MVP binding (dev only)
  proxy_set_header X-TLS-Session-ID $ssl_session_id;
  add_header X-Debug-TLS-Session-ID $ssl_session_id always;

    location / {
      proxy_pass http://app:8080;
  # Preserve original host:port for signature base authority component
  proxy_set_header Host $host:$server_port;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

      # Forward PCH headers
      proxy_set_header PCH-Channel-Binding $http_pch_channel_binding;
      proxy_set_header PCH-Challenge $http_pch_challenge;
      proxy_set_header Signature-Input $http_signature_input;
      proxy_set_header Signature $http_signature;
      proxy_set_header Evidence $http_evidence;
      proxy_set_header Content-Digest $http_content_digest;
      proxy_set_header Content-Type $http_content_type;
    }
  }
}
